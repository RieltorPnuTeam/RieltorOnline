{% block content %}
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
{% for category, message in messages %}
<div class="alert alert-{{ category }}">{{ message }}</div>
{% endfor %}
{% endif %}
{% endwith %}
<div class="container">
    <h1> </h1>
    <h1>{{ apartment.Type }} в місті {{ apartment.City }}, на вулиці {{ apartment.Street }}</h1>
    <p><strong>Місто: </strong> {{ apartment.City }}</p>
    <p><strong>Вулиця: </strong> {{ apartment.Street }}</p>
    <p><strong>Номер будинку: </strong> {{ apartment.HouseNum }}</p>
    <p><strong>Номер квартири (за наявності): </strong> {{ apartment.FlatNum }}</p>
    <p><strong>Ціна: </strong> {{ apartment.Price }}</p>
    <p><strong>Кількість кімнат: </strong> {{ apartment.RoomCount }}</p>
    <p><strong>Опис: </strong> {{ apartment.Description }}</p>
    <p><strong>Комфорт: </strong> {{ apartment.Comfort }}</p>
    <p><strong>Інфраструктура: </strong> {{ apartment.Infrastructure }}</p>
    <p><strong>Ремонт: </strong> {{ apartment.Renovation }}</p>
    <p><strong>Побутова техніка: </strong> {{ apartment.Appliances }}</p>
    <p><strong>Максимальна кількість жителів: </strong> {{ apartment.MaxResidents }}</p>
    <p><strong>Проживає тепер: </strong> {{ apartment.CurrentResidents }}</p>
    <p><strong>Статус житла: </strong> {{ apartment.IsRented }}</p>
    <div>
        <h3>Фото:</h3>
        {% for image in apartment.images %}
        <img src="{{ url_for('static', filename='apartment_pic/' ~ image.ImageURL) }}" alt="Apartment Image"
             style="width:200px; height:auto;">
        {% endfor %}
    </div>
    <div class="container">
    {% if current_user.is_authenticated %}
      {% if apartment in current_user.liked_apartments %}
        <form method="POST" action="{{ url_for('apartment.unlike_apartment', apartment_id=apartment.ApartmentId) }}">
          <button type="submit" class="btn btn-danger">Видалити зі збережених</button>
        </form>
      {% else %}
        <form method="POST" action="{{ url_for('apartment.like_apartment', apartment_id=apartment.ApartmentId) }}">
          <button type="submit" class="btn btn-primary">Зберегти</button>
        </form>
      {% endif %}
    {% endif %}
    <p>Кількість вподобаннь: {{ apartment.FavoriteCount }}</p>
    </div>
    <div>
        <h3>Деталі власника:</h3>
        <p><strong>Ім'я:</strong> {{ owner.Name }}</p>
        <p><strong>Номер телефону:</strong> {{ owner.PhoneNumber }}</p>
        <p><strong>Електронна пошта:</strong> {{ owner.Email }}</p>
    </div>
    <div class="container">
    <h2>Жителі</h2>
    {% if apartment.roommates|length > 0 %}
      <ul>
        {% for roommate in apartment.roommates %}
          <li>
            <p>Ім'я: {{ roommate.user.Name }}</p>
            <p>Електронна пошта: {{ roommate.user.Email }}</p>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>Жителі відсутні</p>
    {% endif %}
</div>
    <h2>Коментарі</h2>
    {% if comments|length > 0 %}
    <ul>
        {% for comment in comments %}
        <li>
            <p>Від: {{ comment.user.Name }}</p>
            <p>{{ comment.Content }}</p>
            <p>Оцінка: {{ comment.Rating }}</p>
            <p>Викладено: {{ comment.DateAdded.strftime('%Y-%m-%d %H:%M:%S') }}</p>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p>Коментарі відсутні</p>
    {% endif %}

    {% if current_user.is_authenticated %}
    <h2>Додати коментар</h2>
    <form method="POST" action="{{ url_for('apartment.view_apartment', apartment_id=apartment.ApartmentId) }}">
        {{ comment_form.hidden_tag() }}
        <div class="form-group">
            <p>Коментар:</p>
            {{ comment_form.Content(class="form-control", rows="3") }}
        </div>
        <div class="form-group">
            <p>Оцінка:</p>
            {{ comment_form.Rating(class="form-control") }}
        </div>
        <button type="submit" class="btn btn-primary">Підтвердити</button>
    </form>
    {% else %}
    <p>Please <a href="{{ url_for('users.login') }}">log in</a> to leave a comment.</p>
    {% endif %}
</div>
{% endblock %}
