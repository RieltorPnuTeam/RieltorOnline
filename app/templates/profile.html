{% block content %}
<div class="container">
    <h1>Edit Profile</h1>
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %}
    {% endif %}
    {% endwith %}
    <form method="POST" action="{{ url_for('main.profile') }}" enctype="multipart/form-data">
        {{ form.hidden_tag() }}
        <div class="form-group">
            {{ form.name.label }} {{ form.name(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.phone_number.label }} {{ form.phone_number(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.user_type.label }} {{ form.user_type(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.password.label }} {{ form.password(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.confirm_password.label }} {{ form.confirm_password(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.profile_image.label }} {{ form.profile_image(class="form-control-file") }}
        </div>
        <button type="submit" class="btn btn-primary">Save Changes</button>
    </form>

    <hr>

    <div class="row">
        <div class="col-md-4">
            {% if current_user.UserImage %}
            <img src="{{ url_for('static', filename='profile_pic/' + current_user.UserImage) }}"
                 class="img-fluid rounded-circle" alt="Profile Image">
            {% else %}
            <img src="{{ url_for('static', filename='profile_pic/default.jpg') }}" class="img-fluid rounded-circle"
                 alt="Profile Image">
            {% endif %}
        </div>
        <div class="col-md-8">
            <h3>{{ current_user.Name }}</h3>
            <p>Phone Number: {{ current_user.PhoneNumber }}</p>
            <p>Email: {{ current_user.Email }}</p>
            <p>User Type: {{ current_user.UserType }}</p>
        </div>
    </div>

    <hr>

    <h2>Comments</h2>
    <div class="comments">
        {% for comment in comments_received %}
        <div class="comment">
            <p>{{ comment.Content }}</p>
            <p>Rating: {{ comment.Rating }}</p>
            <p>Posted by: {{ comment.author.Name }}</p>
            <p>Date: {{ comment.DateAdded }}</p>
        </div>
        {% else %}
        <p>No comments yet.</p>
        {% endfor %}
    </div>

    <hr>

    <h2>Liked Apartments</h2>
    <div class="liked-apartments">
        <div class="row">
            {% for apartment in liked_apartments %}
            <div class="col-md-4 mb-3">
                <div class="card">
                    <img src="{{ url_for('static', filename='apartment_pic/' + apartment.images[0].ImageURL) }}"
                         class="card-img-top" alt="Apartment Image">
                    <div class="card-body">
                        <h5 class="card-title">{{ apartment.Type }} in {{ apartment.City }}</h5>
                        <p class="card-text">Price: ${{ apartment.Price }}</p>
                        <p class="card-text">Room Count: {{ apartment.RoomCount }}</p>
                        <a href="#" class="btn btn-primary">View Details</a>
                    </div>
                </div>
            </div>
            {% else %}
            <p>No liked apartments yet.</p>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
